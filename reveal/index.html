<!doctype html>
<meta charset="utf-8" />
<title>Bristol Bloods Draft Reveal</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root { color-scheme: dark }
  html,body{height:100%}
  body{
    margin:0;background:#000;color:#fff;
    display:grid;place-items:center;
    font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }
  .wrap{width:min(100vw,1100px);padding:18px;text-align:center}
  h1{margin:0 0 12px;font-weight:800;letter-spacing:.4px;font-size:clamp(20px,3vw,32px)}

  .loader{display:none;gap:12px;align-items:center;justify-content:center;margin:14px 0 18px}
  .spinner{width:28px;height:28px;border-radius:50%;border:3px solid #333;border-top-color:#e11;animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .muted{color:#aaa;font-size:14px}

  #card{display:block;margin:0 auto;max-width:96vw;max-height:84vh;
    background:#000;border-radius:10px;opacity:0;transform:scale(.98);
    transition:opacity .35s ease,transform .35s ease;
    box-shadow:0 10px 40px rgba(0,0,0,.6)}
  #card.show{opacity:1;transform:scale(1)}

  .btn{margin-top:10px;background:#e11;color:#fff;border:0;padding:10px 14px;border-radius:10px;font:inherit;cursor:pointer}
  .btn.hidden{display:none}

  .err{display:none;margin:12px auto;padding:12px 14px;background:#180000;color:#ffb3b3;border:1px solid #3a0000;border-radius:10px}
  .err.show{display:block}
</style>

<div class="wrap">
  <h1 id="greeting"></h1>

  <button id="go" class="btn">Reveal my fate</button>

  <div id="loader" class="loader">
    <div class="spinner" aria-hidden="true"></div>
    <div>
      <div><strong>Summoning your draft cardâ€¦</strong></div>
      <div class="muted">This can take a few seconds the first time.</div>
    </div>
  </div>

  <img id="card" alt="Draft reveal" hidden />
  <div id="err" class="err"></div>
</div>

<script>
(() => {
  const qs   = new URLSearchParams(location.search);
  const name = (qs.get("name") || "Stranger").trim();
  document.getElementById("greeting").textContent =
    `Ready to embarrass yourself again, ${name}?`;

  const btn    = document.getElementById("go");
  const loader = document.getElementById("loader");
  const img    = document.getElementById("card");
  const err    = document.getElementById("err");
  const wrap   = document.querySelector(".wrap");

  function start() {
    if (!qs.get("name")) {
      err.textContent = `Add ?name=YourName to the URL, e.g. ${location.origin}${location.pathname}?name=Kyle`;
      err.classList.add("show");
      return;
    }
    err.classList.remove("show");
    btn.disabled = true;
    loader.style.display = "flex";
    img.hidden = true;
    img.classList.remove("show");

    const url = `https://api.bristolbloods.com/reveal?name=${encodeURIComponent(name)}&cb=${Date.now()}`;
    img.onload = () => {
      loader.style.display = "none";
      img.hidden = false;
      requestAnimationFrame(() => img.classList.add("show"));
      btn.classList.add("hidden"); // Hide the button

      // ðŸ‘‡ Add snarky overview link here
      const overview = document.createElement("p");
      overview.style.marginTop = "14px";
      overview.innerHTML = `<a href="https://bristolbloods.com/overview/">See how the rest of these losers made out â†’</a>`;
      wrap.appendChild(overview);
    };
    img.onerror = () => {
      loader.style.display = "none";
      err.textContent = `Could not load card for "${name}".`;
      err.classList.add("show");
      btn.disabled = false;
    };
    img.src = url;
  }

  btn.addEventListener("click", start);

  // Optional: auto-start if ?autoplay=1
  if (qs.get("autoplay") === "1") start();
})();
</script>
